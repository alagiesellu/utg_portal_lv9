(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{133:function(t,e,s){"use strict";s.r(e);function a(t,e){var s="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return n(t,e)}(t))||e&&t&&"number"==typeof t.length){s&&(t=s);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){s=s.call(t)},n:function(){var t=s.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==s.return||s.return()}finally{if(l)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}var r={name:"AssessmentGrade",components:{downloadexcel:s(61).a},data:function(){return{json_fields:{"#":"mark",Name:"name","MAT Number":"mat",Score:"score",Grade:"grade"},assessment:{},students_registrations:{},term_class:{},grades:{},confirm:!1,editable:[],all_stored:!0,input_csv:null}},created:function(){this.fetchData()},watch:{$route:"fetchData"},methods:{onFileChange:function(t){var e=this,s=t.target.files||t.dataTransfer.files;if(s.length){var n=new FileReader;n.readAsText(s[0]),n.onload=function(t){var s,n=[],r=a(t.target.result.split("\n"));try{for(r.s();!(s=r.n()).done;){var o=s.value;">"===o.charAt(0)&&(n=o.split(","),e.grades["_"+n[2]].scores[e.$route.params.ass]=n[3],e.$forceUpdate())}}catch(t){r.e(t)}finally{r.f()}},this.$modal.hide("upload_csv")}},getCSV:function(){var t=[];for(var e in this.grades)t.push({mark:">",name:this.$root.full_name(this.grades[e].student_profile.user),mat:this.grades[e].student_profile.user.num,score:this.grades[e].scores[this.$route.params.ass],grade:this.assessment.score});return t},startDownload:function(){},finishDownload:function(){},submitForm:function(t){var e=this;t.preventDefault(),this.confirm?axios.post("/academic/grades/store",{grades:this.grades,assessment:this.assessment.id}).then((function(t){e.$root.post_success(t.data.success),e.load_grades(t.data.grades),e.calEditable()})):this.confirm=!0},calEditable:function(){for(var t in this.all_stored=!0,this.grades)this.editable[this.grades[t].id]=this.grades[t].scores[this.$route.params.ass],void 0!==this.editable[this.grades[t].id]&&null!==this.editable[this.grades[t].id]||(this.all_stored=!1)},fetchData:function(){this.get_grades(),this.get_assessment(),this.get_term_class()},get_grades:function(){var t=this;axios.get("/academic/grades/"+this.$route.params.tc+"/assignment").then((function(e){t.load_grades(e.data.grades),t.calEditable()}))},load_grades:function(t){this.grades={};var e,s=a(t);try{for(s.s();!(e=s.n()).done;){var n=e.value;this.grades["_"+n.student_profile.user.num]=n}}catch(t){s.e(t)}finally{s.f()}},get_term_class:function(){var t=this;axios.get("/academic/classes/"+this.$route.params.tc).then((function(e){t.term_class=e.data.term_class}))},get_assessment:function(){var t=this;axios.get("/academic/assessments/"+this.$route.params.ass).then((function(e){t.assessment=e.data.assessment}))},get_students:function(){var t=this;axios.get("/academic/classes/"+this.$route.params.tc+"/registrations/all").then((function(e){t.students_registrations=e.data.class_registrations}))}}},o=s(0),i=Object(o.a)(r,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{staticClass:"col-xl-12 order-xl-1"},[s("div",{staticClass:"card shadow"},[s("div",{staticClass:"card-header"},[s("button",{staticClass:"btn btn-outline-primary btn-sm float-right",on:{click:function(e){return t.$parent.$router.back()}}},[s("i",{staticClass:"ni ni-bold-left"}),t._v(" Back\n                    ")]),t._v(" "),t.term_class.course?s("h4",[s("small",[t._v("Course:")]),t._v("\n                        "+t._s(t.term_class.course.name)+"\n                    ")]):t._e(),t._v(" "),s("h4",[s("small",[t._v("Assessment:")]),t._v("\n                        "+t._s(t.assessment.name)+"\n                    ")]),t._v(" "),s("hr"),t._v(" "),t.term_class.course?s("downloadexcel",{staticClass:"btn btn-sm btn-outline-default",attrs:{fetch:t.getCSV,fields:t.json_fields,name:t.term_class.course.name.replace(/\s+/g,"_").toLowerCase()+" - "+t.assessment.name.replace(/\s+/g,"_").toLowerCase()+".csv","before-generate":t.startDownload,"before-finish":t.finishDownload,type:"csv"}},[s("i",{staticClass:"ni ni-cloud-download-95"}),t._v("\n                        Download CSV\n                    ")]):t._e(),t._v(" "),s("button",{staticClass:"btn btn-sm btn-outline-default",on:{click:function(e){return t.$modal.show("upload_csv")}}},[s("i",{staticClass:"ni ni-cloud-upload-96"}),t._v("\n                        Upload CSV\n                    ")])],1),t._v(" "),s("div",{staticClass:"card-body"},[s("form",{on:{submit:t.submitForm}},[s("table",{staticClass:"table"},[t._m(0),t._v(" "),s("tbody",[t._l(Object.keys(t.grades),(function(e){return s("tr",[s("th",[t._v(t._s(t.$root.full_name(t.grades[e].student_profile.user)))]),t._v(" "),s("th",[t._v(t._s(t.grades[e].student_profile.user.num))]),t._v(" "),s("th",[null==t.editable[t.grades[e].id]?s("div",{staticClass:"form-group"},[s("div",{staticClass:"input-group input-group-sm mb-4"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.grades[e].scores[t.$route.params.ass],expression:"grades[i].scores[$route.params.ass]"}],staticClass:"form-control",attrs:{placeholder:"score",type:"number",step:"0.01",min:"0",max:t.assessment.score},domProps:{value:t.grades[e].scores[t.$route.params.ass]},on:{input:function(s){s.target.composing||t.$set(t.grades[e].scores,t.$route.params.ass,s.target.value)}}}),t._v(" "),s("div",{staticClass:"input-group-append"},[s("span",{staticClass:"input-group-text"},[t._v("/ "+t._s(t.assessment.score))])])])]):s("span",[t._v("\n                                        "+t._s(t.grades[e].scores[t.$route.params.ass]+" / "+t.assessment.score)+"\n                                    ")])])])})),t._v(" "),t.all_stored?s("tr",[s("td",{staticClass:"h1 text-danger",attrs:{colspan:"3"}},[t._v("You cannot modify grades! Inform appropriate authorities if need be.")])]):s("tr",[s("td",{staticClass:"text-right",attrs:{colspan:"3"}},[t.confirm?s("span",[t._m(1),t._v(" "),s("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button"},on:{click:function(e){t.confirm=!1}}},[t._v("Cancel")]),t._v(" "),s("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"submit"}},[t._v("Save Changes")])]):s("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"submit"}},[t._v("Store")])])])],2)])])])])]),t._v(" "),s("modal",{attrs:{scrollable:!0,name:"upload_csv",height:"auto",draggable:!0}},[s("div",{staticClass:"modal modal-content"},[s("h3",{staticClass:"modal-header"},[t._v("Upload CSV file with students grades added.")]),t._v(" "),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"form-group mb-3"},[s("div",{staticClass:"input-group"},[s("div",{staticClass:"input-group-prepend"},[s("span",{staticClass:"input-group-text"},[s("i",{staticClass:"ni ni-lock-circle-open"})])]),t._v(" "),s("input",{staticClass:"form-control",attrs:{placeholder:"CSV file",accept:".csv",type:"file"},on:{change:t.onFileChange}})])])])])])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",[e("th",{attrs:{colspan:"2"}},[this._v("Student")]),this._v(" "),e("th",[this._v("Score")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"form-group mb-3"},[e("label",{staticClass:"form-control-label"},[this._v("\n                                                 Save Scores.\n")])])}],!1,null,"1d62fa17",null);e.default=i.exports},61:function(t,e,s){"use strict";(function(t){"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var s=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){t.exports=function t(e,s,a){var n,r,o=window,i="application/octet-stream",l=a||i,c=e,d=!s&&!a&&c,u=document.createElement("a"),f=function(t){return String(t)},h=o.Blob||o.MozBlob||o.WebKitBlob||f,p=s||"download";if(h=h.call?h.bind(o):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),d&&d.length<2048&&(p=d.split("/").pop().split("?")[0],u.href=d,-1!==u.href.indexOf(d))){var m=new XMLHttpRequest;return m.open("GET",d,!0),m.responseType="blob",m.onload=function(e){t(e.target.response,p,i)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&h!==f))return navigator.msSaveBlob?navigator.msSaveBlob(_(c),p):y(c);l=(c=_(c)).type||i}else if(/([\x80-\xff])/.test(c)){for(var v=0,g=new Uint8Array(c.length),b=g.length;v<b;++v)g[v]=c.charCodeAt(v);c=new h([g],{type:l})}function _(t){for(var e=t.split(/[:;,]/),s=e[1],a=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),n=a.length,r=0,o=new Uint8Array(n);r<n;++r)o[r]=a.charCodeAt(r);return new h([o],{type:s})}function y(t,e){if("download"in u)return u.href=t,u.setAttribute("download",p),u.className="download-js-link",u.innerHTML="downloading...",u.style.display="none",document.body.appendChild(u),setTimeout((function(){u.click(),document.body.removeChild(u),!0===e&&setTimeout((function(){o.URL.revokeObjectURL(u.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,i)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var s=document.createElement("iframe");document.body.appendChild(s),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,i)),s.src=t,setTimeout((function(){document.body.removeChild(s)}),333)}if(n=c instanceof h?c:new h([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(o.URL)y(o.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===f)try{return y("data:"+l+";base64,"+o.btoa(n))}catch(t){return y("data:"+l+","+encodeURIComponent(n))}(r=new FileReader).onload=function(t){y(this.result)},r.readAsDataURL(n)}return!0}}));var a=function(t,e,s,a,n,r,o,i,l,c){"boolean"!=typeof o&&(l=i,i=o,o=!1);var d,u="function"==typeof s?s.options:s;if(t&&t.render&&(u.render=t.render,u.staticRenderFns=t.staticRenderFns,u._compiled=!0,n&&(u.functional=!0)),a&&(u._scopeId=a),r?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,l(t)),t&&t._registeredComponents&&t._registeredComponents.add(r)},u._ssrRegister=d):e&&(d=o?function(){e.call(this,c(this.$root.$options.shadowRoot))}:function(t){e.call(this,i(t))}),d)if(u.functional){var f=u.render;u.render=function(t,e){return d.call(e),f(t,e)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,d):[d]}return s};const n={props:{type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,required:!1},exportFields:{type:Object,required:!1},defaultValue:{type:String,required:!1,default:""},title:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function}},computed:{idName:()=>"export_"+(new Date).getTime(),downloadFields(){return void 0!==this.fields?this.fields:void 0!==this.exportFields?this.exportFields:void 0}},methods:{async generate(){"function"==typeof this.beforeGenerate&&await this.beforeGenerate();let t=this.data;if("function"!=typeof this.fetch&&t||(t=await this.fetch()),!t||!t.length)return;let e=this.getProcessedJson(t,this.downloadFields);return"html"===this.type?this.export(this.jsonToXLS(e),this.name.replace(".xls",".html"),"text/html"):"csv"===this.type?this.export(this.jsonToCSV(e),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(e),this.name,"application/vnd.ms-excel")},export:async function(t,e,a){let n=this.base64ToBlob(t,a);"function"==typeof this.beforeFinish&&await this.beforeFinish(),s(n,e,a)},jsonToXLS(t){let e="<thead>";const s=Object.keys(t[0]).length;let a=this;null!=this.title&&(e+=this.parseExtraData(this.title,'<tr><th colspan="'+s+'">${data}</th></tr>')),e+="<tr>";for(let s in t[0])e+="<th>"+s+"</th>";return e+="</tr>",e+="</thead>",e+="<tbody>",t.map((function(t,s){e+="<tr>";for(let s in t)e+="<td>"+a.valueReformattedForMultilines(t[s])+"</td>";e+="</tr>"})),e+="</tbody>",null!=this.footer&&(e+="<tfoot>",e+=this.parseExtraData(this.footer,'<tr><td colspan="'+s+'">${data}</td></tr>'),e+="</tfoot>"),'<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>'.replace("${table}",e).replace("${worksheet}",this.worksheet)},jsonToCSV(t){var e=[];null!=this.title&&e.push(this.parseExtraData(this.title,"${data}\r\n"));for(let s in t[0])e.push(s),e.push(",");return e.pop(),e.push("\r\n"),t.map((function(t){for(let s in t){let a='="'+t[s]+'"';a.match(/[,"\n]/)&&(a='"'+a.replace(/\"/g,'""')+'"'),e.push(a),e.push(",")}e.pop(),e.push("\r\n")})),null!=this.footer&&e.push(this.parseExtraData(this.footer,"${data}\r\n")),e.join("")},getProcessedJson(t,e){let s=this.getKeys(t,e),a=[],n=this;return t.map((function(t,e){let r={};for(let e in s){let a=s[e];r[e]=n.getValue(a,t)}a.push(r)})),a},getKeys(t,e){if(e)return e;let s={};for(let e in t[0])s[e]=e;return s},parseExtraData(t,e){let s="";if(Array.isArray(t))for(var a=0;a<t.length;a++)s+=e.replace("${data}",t[a]);else s+=e.replace("${data}",t);return s},getValue(t,e){const s="object"!=typeof t?t:t.field;let a="string"!=typeof s?[]:s.split("."),n=this.defaultValue;return n=s?a.length>1?this.getValueFromNestedItem(e,a):this.parseValue(e[s]):e,t.hasOwnProperty("callback")&&(n=this.getValueFromCallback(n,t.callback)),n},valueReformattedForMultilines:t=>"string"==typeof t?t.replace(/\n/gi,"<br/>"):t,getValueFromNestedItem(t,e){let s=t;for(let t of e)s&&(s=s[t]);return this.parseValue(s)},getValueFromCallback(t,e){if("function"!=typeof e)return this.defaultValue;const s=e(t);return this.parseValue(s)},parseValue(t){return t||0===t||"boolean"==typeof t?t:this.defaultValue},base64ToBlob(t,e){let s=window.btoa(window.unescape(encodeURIComponent(t))),a=atob(s),n=a.length,r=new Uint8ClampedArray(n);for(;n--;)r[n]=a.charCodeAt(n);return new Blob([r],{type:e})}}};var r=function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:this.idName},on:{click:this.generate}},[this._t("default",[this._v("\n\t\tDownload "+this._s(this.name)+"\n\t")])],2)};r._withStripped=!0;var o=a({render:r,staticRenderFns:[]},void 0,n,void 0,!1,void 0,void 0,void 0);e.a=o}).call(this,s(3))}}]);